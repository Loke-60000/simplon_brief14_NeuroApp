<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Full View Patient</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="{{ url_for('static', path='styles.css') }}"
    />

    <style></style>
  </head>
  <body>
    <nav>
      <div class="NavContainer">
        <h2 class="logo"><a href="/">NEUROGUARD üõ°Ô∏è</a></h2>

        <div class="LinkContainer">
          <a href="/">Home</a>
          <a href="/add_patient">Add New Patient</a>
          <a href="/view_patients">View all</a>
          <a href="/docs#">doc</a>
          <div class="searchbarContainer">
            <input
              id="search-input"
              type="text"
              placeholder="Enter Patient name"
            />
            <button id="search-button" class="search-button">
              <img src="../static/src/search_icon.svg" class="button-image" />
            </button>
          </div>
        </div>
      </div>
    </nav>

    <table>
      <caption>
        <h1>Patient Information</h1>
      </caption>
      <tr>
        <th>Attribute</th>
        <th>Value</th>
      </tr>
      <tr>
        <td>Name</td>
        <td>{{ patient.name }}</td>
      </tr>
      <tr>
        <td>Age</td>
        <td>{{ patient.age }}</td>
      </tr>
      <tr>
        <td>Gender</td>
        <td>{{ patient.gender }}</td>
      </tr>
      <tr>
        <td>Image Name</td>
        <td>{{ patient.scanner_name }}</td>
      </tr>
      <tr>
        <td>Scanner Image</td>
        <td>
          <img
            src="data:image/png;base64,{{ patient.scanner_img }}"
            alt="Scanner Image"
          />
        </td>
      </tr>
    </table>

    <table>
      <caption>
        Prediction Result
      </caption>
      {% if patient.AI_predict %}
      <tr>
        <th>Label</th>
        <td>{{ patient.AI_predict }}</td>
      </tr>
      <tr>
        <th>Confidence</th>
        {% if patient.AI_predict == "no" %}
        <td>{{ (1 - patient.confidence) * 100 }}%</td>
        {% endif %}
        {% if patient.AI_predict == "yes" %}
        <td>{{ patient.confidence * 100 }}%</td>
        {% endif %}
      </tr>
      <tr>
        <th>Date</th>
        <td>{{ patient.prediction_date }}</td>
      </tr>
      {% else %}
      <tr>
        <td colspan="2">No prediction result available.</td>
      </tr>
      {% endif %}
    </table>
    <table>
      <caption>
        Validation of the prediction
      </caption>
      {% if patient.AI_predict %}
      <tr>
        <th>Do you agree with prediction ?:</th>
        <td><select id="predict_check" name="predict_check">
      <option value="yes">Yes I agree</option>
      <option value="no">No I don't agree</option>
      </select>
      <button type="button" id="checkBtn">Send check</button>

      </td>
      </tr>
          {% else %}
      <tr>
        <td colspan="2">Waiting for prediction.</td>
      </tr>
      {% endif %}
    </table>
    <script>
      const submitCheck = document.getElementById('checkBtn');
      submitCheck.addEventListener('click', () => {
          // get the value check
          const doc_check = document.getElementById("predict_check").value;
          // Effectuer une requ√™te vers l'endpoint de modification du patient
          fetch(`/check_predict_post/${patient_id}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ predict_check: doc_check })
                })
                .then(response => response.json())
                .then(data => {
                    // Rediriger vers la vue des patients apr√®s l'√©dition
                    window.location.href = '/view_patients';
                })
                .catch(error => console.error('Error:', error));
      });  
 </script>

  </body>
</html>
